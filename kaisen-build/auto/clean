#!/bin/bash

set -e

GREEN='\e[1;32m'
RED='\e[1;31m'

if [[ $EUID -ne 0 ]]; then
        echo -e $RED "Run this script as root or with the sudo command."
        exit 1
fi

lb clean noauto "$@"
rm -rf cache config unpacked-initrd .build tmp images
sed -i "s/Kaisen Linux Rolling .* Live/Kaisen Linux Rolling Live/g" common/includes.binary/boot/grub/grub.cfg
sed -i "s/Kaisen Linux Rolling .* Install/Kaisen Linux Rolling Install/g" common/includes.binary/boot/grub/grub.cfg
sed -i "s/Kaisen Linux .*/Kaisen Linux/g" common/includes.binary/.disk/info
sed -i "0,/Kaisen Linux Rolling/ s/Kaisen Linux Rolling .*/Kaisen Linux Rolling/" common/includes.binary/isolinux/menu.cfg
sed -i 's/Kaisen Linux NETINST .*/Kaisen Linux NETINST"/g' variant/NETINST/simple-cdd.conf
sed -i 's/Kaisen Linux Rolling NETINST .*"/Kaisen Linux Rolling NETINST"/g' variant/NETINST/simple-cdd.conf
sed -i "s/Kaisen Linux Rolling NETINST .*|g/Kaisen Linux Rolling NETINST|g/g" variant/NETINST/hook
echo -e $GREEN "All files and configurations generated by kaisen-build were deleted successfully."
