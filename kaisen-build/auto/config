#!/bin/bash

#ISO build script for Kaisen Linux

set -e

PARAMS=""

mkdir config || true

if [[ "$variant" = "KDE" || "$variant" = "LXDE" || "$variant" = "MATE" || "$variant" = "XFCE" || "$variant" = "SR" ]]; then
cp -rf common/* config
cp -rfTL variant/$variant config
elif [[ "$variant" = "CUSTOM" ]]; then
cp -rf variant/CUSTOM/* config
fi

case $variant in
        KDE|LXDE|MATE|XFCE)
	PARAMS="$PARAMS --debian-installer live --debian-installer-distribution kaisen-rolling --debian-installer-gui true --firmware-binary true --firmware-chroot true"
        ;;
        SR)
	PARAMS="$PARAMS --debian-installer none --firmware-binary true --firmware-chroot true"
	;;
	CUSTOM)
	PARAMS="$PARAMS --debian-installer live --debian-installer-distribution kaisen-rolling --debian-installer-gui true --iso-preparer Personal --iso-publisher Personal --firmware-binary true --firmware-chroot true"
	;;
esac

lb config noauto \
--apt "apt" \
--apt-indices "true" \
--apt-recommends "true" \
--apt-secure "true" \
--apt-source-archives "true" \
--architecture "amd64" \
--archive-areas "main contrib non-free" \
--binary-image "iso-hybrid" \
--binary-filesystem "fat32" \
--build-with-chroot "true" \
--bootloaders "syslinux,grub-efi" \
--cache "false" \
--cache-indices "false" \
--cache-packages "false" \
--checksums "none" \
--chroot-squashfs-compression-type "xz" \
--clean \
--color \
--debconf-frontend "noninteractive" \
--distribution "kaisen-rolling" \
--distribution-binary "kaisen-rolling" \
--distribution-chroot "kaisen-rolling" \
--iso-preparer "Kevin Chevreuil - Kaisen" \
--iso-publisher "Kevin Chevreuil - Kaisen" \
--iso-application "Kaisen Linux $variant $version" \
--iso-volume "Kaisen Linux $variant $version" \
--linux-flavours "amd64" \
--linux-packages "linux-image" \
--keyring-package "kaisen-archive-keyring" \
--memtest "memtest86+" \
--security "false" \
--source "false" \
--uefi-secure-boot "disable" \
--backports "false" \
--updates "false" \
--win32-loader "false" \
--loadlin "false" \
--zsync "false" \
--system "live" \
--verbose \
--parent-mirror-bootstrap "https://deb.kaisenlinux.org" \
--parent-mirror-chroot "https://deb.kaisenlinux.org" \
--parent-mirror-binary "https://deb.kaisenlinux.org" \
--parent-mirror-debian-installer "https://deb.kaisenlinux.org" \
--mirror-bootstrap "https://deb.kaisenlinux.org" \
--mirror-chroot "https://deb.kaisenlinux.org" \
--mirror-binary "https://deb.kaisenlinux.org" \
--mirror-debian-installer "https://deb.kaisenlinux.org" \
--parent-archive-areas "main contrib non-free" \
$PARAMS \
